
archivesBaseName = "gax-grpc"

dependencies {
  compile project(':gax'),
    libraries.grpcNetty,
    libraries.grpcStub,
    libraries.grpcAuth,
    libraries.grpcProtobuf,
    libraries.guava,
    libraries.jsr305,
    libraries.autovalue,
    libraries.threetenbp,
    libraries.auth,
    libraries.authCredentials,
    libraries.commonProtos,
    libraries.apiCommon

  testCompile project(':gax').sourceSets.test.output,
    libraries.junit,
    libraries.mockito,
    libraries.truth,
    libraries.commons,
    libraries.commonProtosGrpc

  apt libraries.autovalue

  shadowNoGuava libraries.guava,
    libraries.grpcStub,
    libraries.grpcProtobuf
}

task createProperties(dependsOn: processResources) << {
  def propertiesDir = "$buildDir/resources/main/com/google/api/gax/grpc/"
  new File(propertiesDir).mkdirs()
  Properties p = new Properties()
  p['version'] = project.version.toString()
  p['grpc_version'] = grpcVersion
  p.store(new PrintWriter(propertiesDir + "project.properties", "UTF-8"), null)
}

classes {
  dependsOn createProperties
}
